# [PE-EXPLOIT-007]: IoT Edge Runtime Escalation

## Metadata
| Attribute | Details |
|---|---|
| **Technique ID** | PE-EXPLOIT-007 |
| **MITRE ATT&CK v18.1** | [Exploitation for Privilege Escalation (T1068)](https://attack.mitre.org/techniques/T1068/) |
| **Tactic** | Privilege Escalation |
| **Platforms** | Azure IoT Edge (Linux) |
| **Severity** | **High** |
| **Author** | SERVTEP (Pchelnikau Artur) |

## 2. EXECUTIVE SUMMARY
- **Concept:** Azure IoT Edge modules are Docker containers. The `edgeAgent` and `edgeHub` are privileged system modules. If an attacker compromises a custom user module, they may find the `workload_uri` (socket) or the management socket exposed. By impersonating the `edgeAgent` or abusing weak permissions on the `iotedge` daemon socket, they can request the daemon to execute privileged operations or extract module identities (keys).
- **Attack Surface:** IoT Edge Workload API.
- **Business Impact:** **Device Takeover**. Changing the device configuration or deploying malicious modules.

## 3. PREREQUISITES & CONFIGURATION
- **Required Privileges:** RCE in an IoT Module.
- **Tools:** `curl`, `iotedge`

## 4. ATTACK (Red Team Operations)

#### 4.1 Usage
**Step 1: Check Environment**
Check for `IOTEDGE_WORKLOADURI`.
```bash
env | grep IOTEDGE
```

**Step 2: Sign Request**
Ask the Workload API to sign data (using the module's identity).
```bash
curl --unix-socket /var/run/iotedge/workload.sock ...
```

**Step 3: Escalate**
If the socket permissions are weak (`666` or group access), restart `edgeAgent` with malicious config overrides to mount host directories.

## 5. DETECTION (Blue Team Operations)

#### 5.1 Host Logs
| Source | Event | Filter Logic |
|---|---|---|
| **IoT Edge Daemon** | `System Log` | Unexpected calls to the Workload API or module restarts initiated by non-system actors. |

## 6. DEFENSE & REMEDIATION (Hardening)

#### 6.2 Immediate Remediation
*   **Module Isolation:** Ensure custom modules run as non-root users (`User: 1000`).
*   **Socket Permissions:** Verify `iotedge` socket permissions are restricted to the `iotedge` group only.

## 7. ATTACK CHAIN
> **Preceding Technique:** [IA-EXPLOIT-004]
> **Next Logical Step:** [CA-UNSC-017]
